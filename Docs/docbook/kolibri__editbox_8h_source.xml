<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_kolibri__editbox_8h_source" xml:lang="ru">
<title>kolibri_editbox.h</title>
<indexterm><primary>C:/Users/yyari/Documents/KolibriOS/KolibriOS-Cpp-Lib/include/C_Layer/INCLUDE/kolibri_editbox.h</primary></indexterm>
<programlisting linenumbering="unnumbered">1 <emphasis role="preprocessor">#ifndef&#32;KOLIBRI_EDITBOX_H</emphasis>
2 <emphasis role="preprocessor">#define&#32;KOLIBRI_EDITBOX_H</emphasis>
3 
4 <emphasis role="preprocessor">#include&#32;&lt;sys/ksys.h&gt;</emphasis>
5 <emphasis role="preprocessor">#include&#32;&lt;kolibriLib/system/os.hpp&gt;</emphasis>
6 
7 <emphasis role="comment">/*&#32;&#32;flags&#32;meaning</emphasis>
8 <emphasis role="comment">ed_figure_only=&#32;1000000000000000b&#32;&#32;&#32;;����&#32;�������</emphasis>
9 <emphasis role="comment">ed_always_focus=&#32;100000000000000b&#32;&#32;&#32;//&#32;������&#32;�&#32;��������&#32;(�������)</emphasis>
10 <emphasis role="comment">ed_focus=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;10b&#32;&#32;&#32;;�����&#32;�����&#32;����������,&#32;�������&#32;��������������</emphasis>
11 <emphasis role="comment">ed_pass=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;1b&#32;&#32;&#32;;����&#32;�&#32;�������</emphasis>
12 <emphasis role="comment">ed_shift_on=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;1000b&#32;&#32;&#32;;����&#32;��&#32;����������&#32;-������&#32;�������&#32;�����&#32;shift,����&#32;���&#32;����������,&#32;������&#32;��&#32;���&#32;���&#32;-&#32;��&#32;������&#32;���������&#32;shift</emphasis>
13 <emphasis role="comment">ed_shift_on_off=1111111111110111b</emphasis>
14 <emphasis role="comment">ed_shift=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;100b&#32;&#32;&#32;;����������&#32;���&#32;�������&#32;��&#32;shift&#32;�.�.&#32;����&#32;�������</emphasis>
15 <emphasis role="comment">ed_shift_off=&#32;&#32;&#32;1111111111111011b</emphasis>
16 <emphasis role="comment">ed_shift_bac=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;10000b&#32;&#32;&#32;;���&#32;���&#32;�������&#32;����������&#32;shift&#32;�.�.&#32;���&#32;���������&#32;�������&#32;���&#32;����&#32;���������</emphasis>
17 <emphasis role="comment">ed_shift_bac_cl=1111111111101111b&#32;&#32;&#32;;�������&#32;���&#32;��������&#32;���������</emphasis>
18 <emphasis role="comment">ed_shift_cl=&#32;&#32;&#32;&#32;1111111111100011b</emphasis>
19 <emphasis role="comment">ed_shift_mcl=&#32;&#32;&#32;1111111111111011b</emphasis>
20 <emphasis role="comment">ed_left_fl=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;100000b</emphasis>
21 <emphasis role="comment">ed_right_fl=&#32;&#32;&#32;&#32;1111111111011111b</emphasis>
22 <emphasis role="comment">ed_offset_fl=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;1000000b</emphasis>
23 <emphasis role="comment">ed_offset_cl=&#32;&#32;&#32;1111111110111111b</emphasis>
24 <emphasis role="comment">ed_insert=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;10000000b</emphasis>
25 <emphasis role="comment">ed_insert_cl=&#32;&#32;&#32;1111111101111111b</emphasis>
26 <emphasis role="comment">ed_mouse_on&#32;=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;100000000b</emphasis>
27 <emphasis role="comment">ed_mous_adn_b=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;100011000b</emphasis>
28 <emphasis role="comment">ed_mouse_on_off=1111111011111111b</emphasis>
29 <emphasis role="comment">ed_mouse_on_off=&#32;not&#32;(ed_mouse_on)</emphasis>
30 <emphasis role="comment">ed_ctrl_on&#32;=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;1000000000b</emphasis>
31 <emphasis role="comment">ed_ctrl_off&#32;=&#32;not&#32;(ed_ctrl_on)</emphasis>
32 <emphasis role="comment">ed_alt_on&#32;=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;10000000000b</emphasis>
33 <emphasis role="comment">ed_alt_off&#32;=&#32;not&#32;(ed_alt_on)</emphasis>
34 <emphasis role="comment">ed_disabled=&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;100000000000b</emphasis>
35 <emphasis role="comment">*/</emphasis>
36 
37 <emphasis role="keyword">struct&#32;</emphasis><link linkend="_structedit__box">edit_box</link>
38 {
39 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;width;
40 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;left;
41 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;top;
42 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;color;
43 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;shift_color;&#32;&#32;&#32;<emphasis role="comment">//&#32;selected&#32;text&#32;color</emphasis>
44 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;focus_border_color;
45 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;blur_border_color;
46 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;text_color;
47 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;max;
48 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*text;
49 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*mouse_variable;&#32;<emphasis role="comment">//&#32;must&#32;be&#32;pointer&#32;edit_box**&#32;to&#32;save&#32;focused&#32;editbox</emphasis>
50 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;flags;
51 
52 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;size;&#32;&#32;<emphasis role="comment">//&#32;used&#32;symbols&#32;in&#32;buffer&#32;without&#32;trailing&#32;zero</emphasis>
53 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;pos;&#32;&#32;<emphasis role="comment">//&#32;cursor&#32;position</emphasis>
54 <emphasis role="comment">/*&#32;The&#32;following&#32;struct&#32;members&#32;are&#32;not&#32;used&#32;by&#32;the&#32;users&#32;of&#32;API&#32;*/</emphasis>
55 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;offset;
56 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;cl_curs_x;
57 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;cl_curs_y;
58 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;shift;
59 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;shift_old;
60 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;height;
61 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;char_width;
62 };
63 
64 <emphasis role="comment">/*&#32;Initializes&#32;an&#32;Editbox&#32;with&#32;sane&#32;settings,&#32;sufficient&#32;for&#32;most&#32;use.</emphasis>
65 <emphasis role="comment">&#32;&#32;&#32;This&#32;will&#32;let&#32;you&#32;create&#32;a&#32;box&#32;and&#32;position&#32;it&#32;somewhere&#32;on&#32;the&#32;screen.</emphasis>
66 <emphasis role="comment">&#32;&#32;&#32;The&#32;text_buffer&#32;is&#32;a&#32;pointer&#32;to&#32;a&#32;character&#32;array&#32;and&#32;needs&#32;to&#32;be&#32;as&#32;long&#32;as</emphasis>
67 <emphasis role="comment">&#32;&#32;&#32;AT&#32;LEAST&#32;MAX_CHARS&#32;+&#32;1.If&#32;the&#32;text_buffer&#32;is&#32;smaller,&#32;it&#32;will&#32;crash&#32;if&#32;user</emphasis>
68 <emphasis role="comment">&#32;&#32;&#32;types&#32;more&#32;characters&#32;than&#32;what&#32;will&#32;fit&#32;into&#32;the&#32;text&#32;buffer.</emphasis>
69 <emphasis role="comment"></emphasis>
70 <emphasis role="comment">&#32;&#32;&#32;Allocating&#32;buffer&#32;space&#32;automatically&#32;so&#32;that&#32;programmer&#32;can&#32;be&#32;carefree&#32;now.</emphasis>
71 <emphasis role="comment">&#32;&#32;&#32;This&#32;also&#32;automatically&#32;adjusts&#32;the&#32;size&#32;of&#32;edit&#32;box&#32;so&#32;that&#32;it&#32;can&#32;hold&#32;enough&#32;characters.</emphasis>
72 <emphasis role="comment"></emphasis>
73 <emphasis role="comment">&#32;&#32;&#32;All&#32;you&#32;need&#32;is&#32;:</emphasis>
74 <emphasis role="comment"></emphasis>
75 <emphasis role="comment">&#32;&#32;&#32;tlx,tly&#32;=&#32;Coordinates&#32;of&#32;the&#32;beginning&#32;of&#32;the&#32;edit&#32;box.</emphasis>
76 <emphasis role="comment">&#32;&#32;&#32;max_chars&#32;=&#32;Limit&#32;of&#32;number&#32;of&#32;characters&#32;user&#32;can&#32;enter&#32;into&#32;edit&#32;box.</emphasis>
77 <emphasis role="comment">*/</emphasis>
78 
79 <link linkend="_structedit__box">edit_box</link>*&#32;kolibri_new_edit_box(<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;tlx,&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;tly,&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;max_chars,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*editbox_interlock)
80 {
81 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;PIXELS_PER_CHAR&#32;=&#32;7;
82 &#32;&#32;&#32;&#32;<link linkend="_structedit__box">edit_box</link>&#32;*new_textbox&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;<link linkend="_structedit__box">edit_box</link>;
83 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*text_buffer&#32;=&#32;(<emphasis role="keywordtype">char</emphasis>&#32;*)calloc(max_chars&#32;+&#32;2,&#32;<emphasis role="keyword">sizeof</emphasis>(<emphasis role="keywordtype">char</emphasis>));&#32;<emphasis role="comment">//&#32;+2&#32;as&#32;asked&#32;in&#32;box_lib&#32;src</emphasis>
84 
85 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;blur_border_color&#32;and&#32;shift_color&#32;from&#32;box_lib.mac&#32;macro&#32;*/</emphasis>
86 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;edit_boxes_set_sys_color&#32;*/</emphasis>
87 
88 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;width&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;max_chars&#32;*&#32;PIXELS_PER_CHAR;
89 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;left&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;tlx;
90 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;top&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;tly;
91 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;color&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;0xFFFFFF;&#32;<emphasis role="comment">/*&#32;Always&#32;make&#32;white&#32;edit&#32;boxes&#32;*/</emphasis>
92 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;shift_color&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;0x6a9480;
93 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;focus_border_color&#32;&#32;&#32;=&#32;<link linkend="_namespace_kolibri_lib_1_1_o_s_1a3d1ea9fa87ea6d6c8e1a33c18dfb1ebf">KolibriLib::OS::GetSystemColors</link>().work_graph;
94 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;blur_border_color&#32;&#32;&#32;&#32;=&#32;0x6a9480;
95 &#32;&#32;&#32;&#32;new_textbox-&gt;text_color&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;<link linkend="_namespace_kolibri_lib_1_1_o_s_1a3d1ea9fa87ea6d6c8e1a33c18dfb1ebf">KolibriLib::OS::GetSystemColors</link>().work_text;&#32;<emphasis role="comment">/*&#32;Always&#32;black&#32;text&#32;when&#32;typing&#32;*/</emphasis>
96 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;max&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;max_chars;
97 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;text&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;text_buffer;
98 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;mouse_variable&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;editbox_interlock;
99 &#32;&#32;&#32;&#32;new_textbox&#32;-&gt;&#32;flags&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;0x00000000;
100 
101 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;new_textbox;
102 }
103 
104 <emphasis role="keyword">extern</emphasis>&#32;<emphasis role="stringliteral">&quot;C&quot;</emphasis>
105 {
106 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*edit_box_draw)(<link linkend="_structedit__box">edit_box</link>&#32;*)&#32;__attribute__((__stdcall__));
107 
108 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*edit_box_key)(<link linkend="_structedit__box">edit_box</link>&#32;*)&#32;__attribute__((__stdcall__));
109 <emphasis role="comment">/*&#32;editbox_key&#32;is&#32;a&#32;wrapper&#32;written&#32;in&#32;assembly&#32;to&#32;handle&#32;key&#32;press&#32;events&#32;for&#32;editboxes&#32;*/</emphasis>
110 <emphasis role="comment">/*&#32;because&#32;inline&#32;assembly&#32;in&#32;GCC&#32;is&#32;a&#32;PITA&#32;and&#32;interferes&#32;with&#32;the&#32;EAX&#32;(AH)&#32;register&#32;*/</emphasis>
111 <emphasis role="comment">/*&#32;which&#32;edit_box_key&#32;requires&#32;*/</emphasis>
112 __attribute__((__stdcall__))&#32;<emphasis role="keywordtype">void</emphasis>&#32;editbox_key(<link linkend="_structedit__box">edit_box</link>&#32;*e,&#32;ksys_oskey_t&#32;ch)
116 {
117 &#32;&#32;&#32;&#32;__asm__&#32;__volatile__&#32;(
118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;push&#32;%2\n\t&quot;</emphasis>
119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;call&#32;*%1&#32;\n\t&quot;</emphasis>
120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:
121 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:<emphasis role="stringliteral">&quot;a&quot;</emphasis>(ch.val),&#32;<emphasis role="stringliteral">&quot;m&quot;</emphasis>(edit_box_key),&#32;<emphasis role="stringliteral">&quot;m&quot;</emphasis>(e):
122 &#32;&#32;&#32;&#32;);
123 }
124 
125 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*edit_box_mouse)(<link linkend="_structedit__box">edit_box</link>&#32;*)&#32;__attribute__((__stdcall__));
127 
128 
129 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*edit_box_set_text)(<link linkend="_structedit__box">edit_box</link>&#32;*,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*)&#32;__attribute__((__stdcall__));
130 <emphasis role="keyword">extern</emphasis>&#32;<emphasis role="keyword">volatile</emphasis>&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;press_key;
131 }
132 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;KOLIBRI_EDITBOX_H&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
</programlisting></section>
