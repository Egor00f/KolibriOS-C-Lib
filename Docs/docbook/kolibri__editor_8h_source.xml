<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_kolibri__editor_8h_source" xml:lang="ru">
<title>kolibri_editor.h</title>
<indexterm><primary>C:/Users/yyari/Documents/KolibriOS/KolibriOS-Cpp-Lib/include/C_Layer/INCLUDE/kolibri_editor.h</primary></indexterm>
<programlisting linenumbering="unnumbered">1 
2 
3 <emphasis role="preprocessor">#ifndef&#32;KOLIBRI_EDITOR_H</emphasis>
4 <emphasis role="preprocessor">#define&#32;KOLIBRI_EDITOR_H</emphasis>
5 
6 <emphasis role="preprocessor">#include&#32;&lt;kos32sys.h&gt;</emphasis>
7 
8 <emphasis role="comment">//&#32;(êîëè÷åñòâî&#32;ñèìâîëîâ&#32;â&#32;íîâîì&#32;äîêóìåíòå&#32;+&#32;2)</emphasis>
9 <emphasis role="preprocessor">#define&#32;TE_MAXCHARS&#32;100002</emphasis>
10 <emphasis role="comment">//&#32;ìàêñèìàëüíûé&#32;ðàçìåð&#32;ôàéëà&#32;ñèíòàêñèñà</emphasis>
11 <emphasis role="preprocessor">#define&#32;TE_MAX_SYNTAX_FILESIZE&#32;410000</emphasis>
12 <emphasis role="comment">//&#32;buffer&#32;for&#32;copy|paste</emphasis>
13 <emphasis role="preprocessor">#define&#32;TE_BUF_SIZE&#32;4096</emphasis>
14 <emphasis role="keyword">typedef</emphasis>&#32;void&#32;(*editor_callback)(void);
15 
16 <emphasis role="keyword">struct&#32;</emphasis>__attribute__((__packed__))&#32;editor_symbol
17 {
18 &#32;&#32;&#32;&#32;uint8_t&#32;c;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;&#32;+0&#32;ñèìâîë</emphasis>
19 &#32;&#32;&#32;&#32;uint8_t&#32;col;&#32;&#32;&#32;<emphasis role="comment">//&#32;&#32;+1&#32;öâåò</emphasis>
20 &#32;&#32;&#32;&#32;uint32_t&#32;prev;&#32;<emphasis role="comment">//&#32;&#32;+2&#32;èíäåêñ&#32;ïðåäûäóùåãî</emphasis>
21 &#32;&#32;&#32;&#32;uint32_t&#32;next;&#32;<emphasis role="comment">//&#32;&#32;+6&#32;óêàçàòåëè&#32;(èíäåêñ&#32;ñëåäóþùåãî)</emphasis>
22 &#32;&#32;&#32;&#32;uint32_t&#32;tc;&#32;&#32;&#32;<emphasis role="comment">//&#32;&#32;+10&#32;âðåì.&#32;ñîçäàíèÿ</emphasis>
23 &#32;&#32;&#32;&#32;uint32_t&#32;td;&#32;&#32;&#32;<emphasis role="comment">//&#32;+14&#32;âðåì.&#32;óäàëåíèÿ</emphasis>
24 };
25 
27 <emphasis role="keyword">typedef</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis>__attribute__((__packed__))
28 {
29 &#32;&#32;&#32;&#32;uint32_t&#32;x_pos;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0</emphasis>
30 &#32;&#32;&#32;&#32;uint32_t&#32;y_pos;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;50</emphasis>
31 &#32;&#32;&#32;&#32;uint32_t&#32;width;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;440</emphasis>
32 &#32;&#32;&#32;&#32;uint32_t&#32;hight;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;150</emphasis>
33 &#32;&#32;&#32;&#32;uint32_t&#32;w_pane;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;30&#32;øèðèíà&#32;ïàíåëè&#32;â&#32;îêíå,&#32;width&#32;of&#32;left&#32;pane&#32;with&#32;line&#32;numbers</emphasis>
34 &#32;&#32;&#32;&#32;uint32_t&#32;h_pane;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;25&#32;âûñîòà&#32;ïàíåëè&#32;â&#32;îêíå,&#32;hight&#32;of&#32;top&#32;pane&#32;with&#32;Rows,&#32;Cols&#32;Undo&#32;info</emphasis>
35 &#32;&#32;&#32;&#32;uint32_t&#32;width_sym;&#32;<emphasis role="comment">//&#32;9&#32;øèðèíà&#32;ñèìâîëà&#32;(çíàêîìåñòà)&#32;â&#32;îêíå</emphasis>
36 &#32;&#32;&#32;&#32;uint32_t&#32;hight_sym;&#32;<emphasis role="comment">//&#32;16&#32;âûñîòà&#32;ñèìâîëà&#32;(çíàêîìåñòà)&#32;â&#32;îêíå</emphasis>
37 &#32;&#32;&#32;&#32;uint8_t&#32;drag_m;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;âûäåëåíèå&#32;îò&#32;ìûøè</emphasis>
38 &#32;&#32;&#32;&#32;uint8_t&#32;drag_k;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;âûäåëåíèå&#32;îò&#32;êëàâèàòóðû</emphasis>
39 &#32;&#32;&#32;&#32;uint32_t&#32;sel_x0;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ñòðóêòóðà&#32;âûäåëåíèÿ</emphasis>
40 &#32;&#32;&#32;&#32;uint32_t&#32;sel_y0;
41 &#32;&#32;&#32;&#32;uint32_t&#32;sel_x1;
42 &#32;&#32;&#32;&#32;uint32_t&#32;sel_y1;
43 &#32;&#32;&#32;&#32;uint32_t&#32;seln_x0;&#32;<emphasis role="comment">//&#32;äîïîëíèòåëüíàÿ&#32;ñòðóêòóðà&#32;âûäåëåíèÿ</emphasis>
44 &#32;&#32;&#32;&#32;uint32_t&#32;seln_y0;
45 &#32;&#32;&#32;&#32;uint32_t&#32;seln_x1;
46 &#32;&#32;&#32;&#32;uint32_t&#32;seln_y1;
47 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>editor_symbol&#32;*tex;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;text&#32;memory&#32;pointer</emphasis>
48 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>editor_symbol&#32;*tex_1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;çà&#32;ïîñëåäíèì&#32;ñóùåñòâóþùèì&#32;ñèìâîëîì&#32;(êîíåö&#32;ôàéëà)</emphasis>
49 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>editor_symbol&#32;*tex_end;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;text&#32;end&#32;memory&#32;pointer&#32;(óêàçàòåëü&#32;çà&#32;êîíöîì&#32;âûäåëåííîãî&#32;áóôåðà&#32;äëÿ&#32;òåêñòà)</emphasis>
50 &#32;&#32;&#32;&#32;uint32_t&#32;cur_x;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;êîîðäèíàòà&#32;x&#32;êóðñîðà</emphasis>
51 &#32;&#32;&#32;&#32;uint32_t&#32;cur_y;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;êîîðäèíàòà&#32;y&#32;êóðñîðà</emphasis>
52 &#32;&#32;&#32;&#32;uint32_t&#32;max_chars;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;TE_MAXCHARS&#32;;+86&#32;ìàêñèìàëüíîå&#32;÷èñëî&#32;ñèìâîëîâ&#32;â&#32;îäíîì&#32;äîêóìåíòå</emphasis>
53 &#32;&#32;&#32;&#32;uint32_t&#32;count_colors_text;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;1&#32;;+90&#32;êîëè÷åñòâî&#32;öâåòîâ&#32;òåêñòà</emphasis>
54 &#32;&#32;&#32;&#32;uint32_t&#32;count_key_words;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//+94&#32;êîëëè÷åñòâî&#32;êëþ÷åâûõ&#32;ñëîâ</emphasis>
55 &#32;&#32;&#32;&#32;color_t&#32;color_cursor;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0x808080&#32;;+98&#32;öâåò&#32;êóðñîðà</emphasis>
56 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_capt;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0x80&#32;;+102&#32;öâåò&#32;ïîëåé&#32;âîêðóã&#32;îêíà</emphasis>
57 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_work;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0x0&#32;;+106&#32;öâåò&#32;ôîíà&#32;îêíà</emphasis>
58 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_bord;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0xd0d0d0&#32;;+110&#32;öâåò&#32;òåêñòà&#32;íà&#32;ïîëÿõ</emphasis>
59 &#32;&#32;&#32;&#32;color_t&#32;color_select;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0x208080&#32;;+114&#32;öâåò&#32;âûäåëåíèÿ</emphasis>
60 &#32;&#32;&#32;&#32;color_t&#32;color_cur_text;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0xff0000&#32;;+118&#32;öâåò&#32;ñèìâîëà&#32;ïîä&#32;êóðñîðîì</emphasis>
61 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_text;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0xffff00&#32;;+122&#32;öâåò&#32;òåêñòà&#32;â&#32;îêíå</emphasis>
62 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*syntax_file;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;íà÷àëî&#32;ôàéëà&#32;ñèíòàêñèñà</emphasis>
63 &#32;&#32;&#32;&#32;uint32_t&#32;syntax_file_size;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;TE_MAX_SYNTAX_FILESIZE&#32;;+130&#32;ìàêñèìàëüíûé&#32;ðàçìåð&#32;ôàéëà&#32;ñèíòàêñèñà</emphasis>
64 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;*text_colors;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ìàññèâ&#32;öâåòîâ&#32;òåêñòà</emphasis>
65 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*help_text_f1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;òåêñò&#32;ñïðàâêè&#32;(ïî&#32;íàæàòèè&#32;F1)</emphasis>
66 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;help_id;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;-1&#32;;+142&#32;èäåíòèôèêàòîð&#32;äëÿ&#32;ñïðàâêè</emphasis>
67 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;*key_words_data;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ñòðóêòóðû&#32;êëþ÷åâûõ&#32;ñëîâ&#32;TexColViv</emphasis>
68 &#32;&#32;&#32;&#32;uint32_t&#32;tim_ch;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;êîëè÷åñòâî&#32;èçìåíåíèé&#32;â&#32;ôàéëå</emphasis>
69 &#32;&#32;&#32;&#32;uint32_t&#32;tim_undo;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;êîëè÷åñòâî&#32;îòìåíåííûõ&#32;äåéñòâèé</emphasis>
70 &#32;&#32;&#32;&#32;uint32_t&#32;tim_ls;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;âðåìÿ&#32;ïîñëåäíåãî&#32;ñîõðàíåíèÿ</emphasis>
71 &#32;&#32;&#32;&#32;uint32_t&#32;tim_co;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;âðåìÿ&#32;ïîñëåäíåé&#32;öâåòîâîé&#32;ðàçìåòêè</emphasis>
72 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;*el_focus;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ïåðåìåííóþ&#32;ýëåìåíòà&#32;â&#32;ôîêóñå&#32;pointer&#32;to&#32;pointer**</emphasis>
73 &#32;&#32;&#32;&#32;uint8_t&#32;err_save;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;îøèáêà&#32;ñîõðàíåíèÿ&#32;ôàéëà</emphasis>
74 &#32;&#32;&#32;&#32;uint8_t&#32;panel_id;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;íîìåð&#32;îòêðûòîé&#32;ïàíåëè</emphasis>
75 &#32;&#32;&#32;&#32;uint8_t&#32;key_new;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ñèìâîë,&#32;êîòîðûé&#32;áóäåò&#32;äîáàâëÿòñÿ&#32;ñ&#32;êëàâèàòóðû</emphasis>
76 &#32;&#32;&#32;&#32;uint8_t&#32;symbol_new_line;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ascii&#32;20&#32;ñèìâîë&#32;çàâåðøåíèÿ&#32;ñòðîêè</emphasis>
77 &#32;&#32;&#32;&#32;scrollbar&#32;*scr_w;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;âåðòèêàëüíûé&#32;ñêðîëëèíã&#32;!=&#32;NULL</emphasis>
78 &#32;&#32;&#32;&#32;scrollbar&#32;*scr_h;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ãîðèçîíòàëüíûé&#32;ñêðîëëèíã&#32;!=&#32;NULL</emphasis>
79 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*arr_key_pos;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ìàññèâ&#32;ïîçèöèé&#32;êëþ÷åâûõ&#32;ñëîâ</emphasis>
80 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*buffer;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;áóôåð&#32;êîïèðîâàíèÿ/âñòàâêè&#32;!=&#32;NULL,&#32;also&#32;size</emphasis>
81 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*buffer_find;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;áóôåð&#32;äëÿ&#32;ïîèñêà&#32;(sized&#32;302)</emphasis>
82 &#32;&#32;&#32;&#32;uint8_t&#32;cur_ins;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;1&#32;ðåæèì&#32;ðàáîòû&#32;êóðñîðà&#32;(îáû÷íûé&#32;èëè&#32;çàìåíà)</emphasis>
83 &#32;&#32;&#32;&#32;uint8_t&#32;mode_color;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;1&#32;ðåæèì&#32;âûäåëåíèÿ&#32;ñëîâ&#32;öâåòîì&#32;(0-âûêë.&#32;1-âêë.)</emphasis>
84 &#32;&#32;&#32;&#32;uint8_t&#32;mode_invis;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0&#32;ðåæèì&#32;ïîêàçà&#32;íåïå÷àòàåìûõ&#32;ñèìâîëîâ</emphasis>
85 &#32;&#32;&#32;&#32;uint8_t&#32;gp_opt;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;0&#32;îïöèè&#32;âîçâðàùàåìûå&#32;ôóíêöèåé&#32;ted_get_pos_by_cursor</emphasis>
86 &#32;&#32;&#32;&#32;editor_callback&#32;fun_on_key_ctrl_all;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ôóíêöèþ&#32;âûçûâàåìóþ&#32;ïðè&#32;íàæàòèè&#32;Ctrl+N,O,S,F,G,H,&#32;can&#32;be&#32;NULL</emphasis>
87 &#32;&#32;&#32;&#32;uint32_t&#32;reserved_1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;...</emphasis>
88 &#32;&#32;&#32;&#32;uint32_t&#32;reserved_2;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;...</emphasis>
89 &#32;&#32;&#32;&#32;uint32_t&#32;reserved_3;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;...</emphasis>
90 &#32;&#32;&#32;&#32;uint32_t&#32;buffer_size;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;BUF_SIZE&#32;ðàçìåð&#32;áóôåðà&#32;êîïèðîâàíèÿ/âñòàâêè</emphasis>
91 &#32;&#32;&#32;&#32;editor_callback&#32;fun_find_err;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ôóíêöèþ&#32;âûçûâàåìóþ&#32;åñëè&#32;ïîèñê&#32;çàêîí÷èëñÿ&#32;íåóäà÷íî</emphasis>
92 &#32;&#32;&#32;&#32;editor_callback&#32;fun_init_synt_err;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;unused&#32;óêàçàòåëü&#32;íà&#32;ôóíêöèþ&#32;âûçûâàåìóþ&#32;ïðè&#32;îøèáî÷íîì&#32;îòêðûòèè&#32;ôàéëà&#32;ñèíòàêñèñà</emphasis>
93 &#32;&#32;&#32;&#32;editor_callback&#32;fun_draw_panel_buttons;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ôóíêöèþ&#32;ðèñîâàíèÿ&#32;ïàíåëè&#32;ñ&#32;êíîïêàìè</emphasis>
94 &#32;&#32;&#32;&#32;editor_callback&#32;fun_draw_panels;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ôóíêöèþ&#32;ðèñîâàíèÿ&#32;ïàíåëè&#32;ïîèñêà|çàìåíû|ïåðåõîäà|ñèíòàêñèñà</emphasis>
95 &#32;&#32;&#32;&#32;uint32_t&#32;reserved_4;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;...</emphasis>
96 &#32;&#32;&#32;&#32;editor_callback&#32;fun_save_err;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;óêàçàòåëü&#32;íà&#32;ôóíêöèþ&#32;âûçûâàåìóþ&#32;åñëè&#32;ñîõðàíåíèå&#32;ôàéëà&#32;çàêîí÷èëîñü&#32;íåóäà÷íî</emphasis>
97 &#32;&#32;&#32;&#32;uint32_t&#32;increase_size;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;200&#32;÷èñëî&#32;ñèìâîëîâ&#32;íà&#32;êîòîðûå&#32;áóäåò&#32;óâå÷èâàòüñÿ&#32;ïàìÿòü&#32;ïðè&#32;íåõâàòêå</emphasis>
98 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>&#32;*ptr_free_symb;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;èñïîëüçóåòñÿ&#32;âíóòðè&#32;ýëåìåíòà&#32;äëÿ&#32;óñêîðåíèÿ&#32;âñòàâêè&#32;òåêñòà</emphasis>
99 &#32;&#32;&#32;&#32;uint32_t&#32;font_size;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;;+250&#32;ìíîæèòåëü&#32;äëÿ&#32;ðàçìåðà&#32;øðèôòà&#32;//&#32;binary&#32;OR&#32;mask&#32;for&#32;ECX&#32;SysFn4</emphasis>
100 }&#32;editor;
101 
102 <emphasis role="keyword">struct&#32;</emphasis>__attribute__((__packed__))&#32;editor_color_item
103 {
104 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;word[40];&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ñëîâî&#32;äëÿ&#32;ïîäñâåòêè</emphasis>
105 &#32;&#32;&#32;&#32;uint32_t&#32;f1_offset;&#32;<emphasis role="comment">//&#32;ñìåùåíèå&#32;â&#32;òàáëèöå&#32;F1&#32;ïîäñêàçîê</emphasis>
106 &#32;&#32;&#32;&#32;uint8_t&#32;flags;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ôëàãè&#32;èñïîëüçóåìûå&#32;ïðè&#32;âûäåëåíèè</emphasis>
107 &#32;&#32;&#32;&#32;uint8_t&#32;endc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ñèìâîë&#32;êîíöà&#32;âûäåëåíèÿ&#32;(èñïîëüçóåòñÿ&#32;ïðè&#32;flags&amp;4)</emphasis>
108 &#32;&#32;&#32;&#32;uint8_t&#32;escc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;ýêðàíèðóþùèé&#32;ñèìâîë&#32;(èñïîëüçóåòñÿ&#32;ïðè&#32;flags&amp;4)&#32;&#32;ascii(34)&#32;ïðèìåðû&#32;ýêðàíèðîâàíèÿ&#32;\r&#32;\n&#32;\t</emphasis>
109 &#32;&#32;&#32;&#32;uint8_t&#32;color;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;öâåò&#32;ïî&#32;òàáëèöå&#32;öâåòîâ</emphasis>
110 };
111 
112 <emphasis role="keyword">struct&#32;</emphasis><link linkend="_structeditor__syntax__file">editor_syntax_file</link>
113 {
114 &#32;&#32;&#32;&#32;uint32_t&#32;count_colors_text;&#32;<emphasis role="comment">//&#32;êîë-âî&#32;öâåòîâ&#32;òåêñòà&#32;dd&#32;(text-color_wnd_text)/4</emphasis>
115 &#32;&#32;&#32;&#32;uint32_t&#32;count_key_words;&#32;&#32;&#32;<emphasis role="comment">//&#32;êîë-âî&#32;êëþ÷åâûõ&#32;ñëîâ&#32;dd&#32;(f1-text)/48</emphasis>
116 &#32;&#32;&#32;&#32;color_t&#32;color_cursor;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;dd&#32;0xf1fcd0</emphasis>
117 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_capt;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;dd&#32;0x080808</emphasis>
118 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_work;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;dd&#32;0x1C1C1C</emphasis>
119 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_bord;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;dd&#32;0xc0c0c0</emphasis>
120 &#32;&#32;&#32;&#32;color_t&#32;color_select;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;dd&#32;0x3E3D32</emphasis>
121 &#32;&#32;&#32;&#32;color_t&#32;color_cur_text;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;dd&#32;0x808080</emphasis>
122 &#32;&#32;&#32;&#32;color_t&#32;color_wnd_text[];&#32;&#32;&#32;<emphasis role="comment">//&#32;òàáëèöà&#32;öâåòîâ&#32;ðàçìåðîì&#32;count_colors_text</emphasis>
123 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;editor_color_item[];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;//&#32;òàáëèöà&#32;êëþ÷åâûõ&#32;ïîäñâå÷åííûõ&#32;ñëîâ&#32;ðàçìåðîì&#32;count_key_words</emphasis>
124 };
125 
126 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis><link linkend="_structeditor__syntax__file">editor_syntax_file</link>&#32;default_syntax&#32;=&#32;{
127 &#32;&#32;&#32;&#32;10,&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;count_colors_text</emphasis>
128 &#32;&#32;&#32;&#32;1,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;count_key_words&#32;dd&#32;(f1-text)/48,&#32;minimum&#32;1</emphasis>
129 &#32;&#32;&#32;&#32;0xf1fcd0,&#32;<emphasis role="comment">//&#32;color_cursor&#32;dd&#32;0xf1fcd0</emphasis>
130 &#32;&#32;&#32;&#32;0x080808,&#32;<emphasis role="comment">//&#32;color_wnd_capt&#32;dd&#32;0x080808</emphasis>
131 &#32;&#32;&#32;&#32;0x1C1C1C,&#32;<emphasis role="comment">//&#32;color_wnd_work&#32;dd&#32;0x1C1C1C</emphasis>
132 &#32;&#32;&#32;&#32;0xc0c0c0,&#32;<emphasis role="comment">//&#32;color_wnd_bord&#32;dd&#32;0xc0c0c0</emphasis>
133 &#32;&#32;&#32;&#32;0x3E3D32,&#32;<emphasis role="comment">//&#32;color_select&#32;dd&#32;0x3E3D32</emphasis>
134 &#32;&#32;&#32;&#32;0x808080,&#32;<emphasis role="comment">//&#32;color_cur_text&#32;dd&#32;0x808080</emphasis>
135 &#32;&#32;&#32;&#32;{0xD0D0D0,&#32;0xffff00,&#32;0x00ff00,&#32;0x00ffff,&#32;0x808080,&#32;0xff40ff,&#32;0x4080ff,&#32;0xff0000,&#32;0x8080ff,&#32;0x00ccff}};
136 <emphasis role="comment">//&#32;next&#32;structure&#32;must&#32;follow&#32;syntax&#32;definition,&#32;at&#32;least&#32;has&#32;1&#32;element&#32;!!!</emphasis>
137 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis>editor_color_item&#32;word1&#32;=&#32;{
138 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;siemargl&quot;</emphasis>,&#32;1,&#32;0,&#32;0,&#32;1&#32;<emphasis role="comment">//&#32;test&#32;word&#32;colored&#32;as&#32;1st&#32;in&#32;table</emphasis>
139 };
140 <emphasis role="comment">//&#32;next&#32;structure&#32;preferably&#32;follow&#32;syntax&#32;definition,&#32;at&#32;least&#32;has&#32;1&#32;element&#32;!!!</emphasis>
141 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;f1_table[]&#32;=&#32;{
142 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;\0&quot;</emphasis>
143 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;First\0&quot;</emphasis>
144 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;Last\0&quot;</emphasis>};
145 
146 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_draw)(editor&#32;*)&#32;__attribute__((__stdcall__));
147 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_init_scroll_bars)(editor&#32;*,&#32;<emphasis role="keywordtype">int</emphasis>&#32;opt)&#32;__attribute__((__stdcall__));
149 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_init_syntax_file)(editor&#32;*)&#32;__attribute__((__stdcall__));
150 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_mouse)(editor&#32;*)&#32;__attribute__((__stdcall__));
151 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_text_add)(editor&#32;*,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*text,&#32;<emphasis role="keywordtype">int</emphasis>&#32;textlen,&#32;<emphasis role="keywordtype">int</emphasis>&#32;opt)&#32;__attribute__((__stdcall__));
156 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_select_word)(editor&#32;*)&#32;__attribute__((__stdcall__));
158 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_copy)(editor&#32;*)&#32;__attribute__((__stdcall__));
159 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_paste)(editor&#32;*)&#32;__attribute__((__stdcall__));
160 
161 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_find)(editor&#32;*)&#32;__attribute__((__stdcall__));
162 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_replace)(editor&#32;*)&#32;__attribute__((__stdcall__));
164 
165 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_sumb_upper)(editor&#32;*)&#32;__attribute__((__stdcall__));
166 
167 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_sumb_lover)(editor&#32;*)&#32;__attribute__((__stdcall__));
168 
169 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_convert_by_table)(editor&#32;*,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*table)&#32;__attribute__((__stdcall__));
170 
172 <emphasis role="keyword">extern</emphasis>&#32;int&#32;(*ted_can_save)(editor&#32;*)&#32;__attribute__((__stdcall__));
173 
175 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_clear)(editor&#32;*,&#32;<emphasis role="keywordtype">int</emphasis>&#32;all)&#32;__attribute__((__stdcall__));
176 
177 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_delete)(editor&#32;*)&#32;__attribute__((__stdcall__));
178 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;editor_delete(editor&#32;*ed)
180 {
181 &#32;&#32;&#32;&#32;(*ted_delete)(ed);
182 &#32;&#32;&#32;&#32;free(ed-&gt;scr_w);
183 &#32;&#32;&#32;&#32;free(ed-&gt;scr_h);
184 &#32;&#32;&#32;&#32;free(ed-&gt;buffer);
185 &#32;&#32;&#32;&#32;free(ed-&gt;buffer_find);
186 }
187 
189 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_init)(editor&#32;*)&#32;__attribute__((__stdcall__));
190 
192 <emphasis role="keyword">extern</emphasis>&#32;int&#32;(*ted_is_select)(editor&#32;*)&#32;__attribute__((__stdcall__));
193 
194 <emphasis role="keyword">enum</emphasis>&#32;control_keys
195 {
196 &#32;&#32;&#32;&#32;KM_SHIFT&#32;=&#32;0x00010000,
197 &#32;&#32;&#32;&#32;KM_CTRL&#32;=&#32;0x00020000,
198 &#32;&#32;&#32;&#32;KM_ALT&#32;=&#32;0x00040000,
199 &#32;&#32;&#32;&#32;KM_NUMLOCK&#32;=&#32;0x00080000
200 };
201 
202 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_key_asm)(editor&#32;*,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*table,&#32;<emphasis role="keywordtype">int</emphasis>&#32;control)&#32;__attribute__((__stdcall__));
203 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;__attribute__((__stdcall__))&#32;<emphasis role="keywordtype">void</emphasis>&#32;editor_keyboard(editor&#32;*ed,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*table,&#32;<emphasis role="keyword">enum</emphasis>&#32;control_keys&#32;control,&#32;<emphasis role="keywordtype">int</emphasis>&#32;ch)
207 {
208 &#32;&#32;&#32;&#32;__asm__&#32;__volatile__(
209 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;push&#32;%4\n\t&quot;</emphasis>
210 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;push&#32;%3\n\t&quot;</emphasis>
211 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;push&#32;%2\n\t&quot;</emphasis>
212 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;call&#32;*%1&#32;\n\t&quot;</emphasis>&#32;::<emphasis role="stringliteral">&quot;a&quot;</emphasis>(ch),
213 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;m&quot;</emphasis>(ted_key_asm),&#32;<emphasis role="stringliteral">&quot;m&quot;</emphasis>(ed),&#32;<emphasis role="stringliteral">&quot;m&quot;</emphasis>(table),&#32;<emphasis role="stringliteral">&quot;m&quot;</emphasis>(control)&#32;:);
214 &#32;&#32;&#32;&#32;<emphasis role="comment">/*</emphasis>
215 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;__asm__&#32;__volatile__&#32;(</emphasis>
216 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;nop&#32;\n\t&quot;::&quot;a&quot;(ch):);</emphasis>
217 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(*ted_key_asm)(ed,&#32;table,&#32;control);</emphasis>
218 <emphasis role="comment">&#32;&#32;&#32;&#32;*/</emphasis>
219 }
220 
221 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_open_file_asm)(editor&#32;*,&#32;<emphasis role="keyword">struct&#32;</emphasis>fs_dirinfo&#32;*,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*fname)&#32;__attribute__((__stdcall__));
222 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;editor_openfile(editor&#32;*ed,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*fname,&#32;<emphasis role="keywordtype">int</emphasis>&#32;*readbytes)
224 {
225 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;ret;
226 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>fs_dirinfo&#32;di;
227 &#32;&#32;&#32;&#32;__asm__&#32;__volatile__(
228 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;push&#32;%%edi&#32;\n\t&quot;</emphasis>&#32;:::);
229 
230 &#32;&#32;&#32;&#32;(*ted_open_file_asm)(ed,&#32;&amp;di,&#32;fname);
231 
232 &#32;&#32;&#32;&#32;__asm__&#32;__volatile__(
233 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;pop&#32;%%edi&#32;\n\t&quot;</emphasis>&#32;:&#32;<emphasis role="stringliteral">&quot;=b&quot;</emphasis>(*readbytes),&#32;<emphasis role="stringliteral">&quot;=a&quot;</emphasis>(ret)::);
234 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;ret;
235 }
236 
237 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_save_file_asm)(editor&#32;*,&#32;<emphasis role="keyword">struct&#32;</emphasis>fs_dirinfo&#32;*,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*fname)&#32;__attribute__((__stdcall__));
238 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;editor_savefile(editor&#32;*ed,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*fname)
240 {
241 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>fs_dirinfo&#32;di;
242 
243 &#32;&#32;&#32;&#32;(*ted_save_file_asm)(ed,&#32;&amp;di,&#32;fname);
244 
245 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;ed-&gt;err_save;
246 }
247 
248 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_cut)(editor&#32;*)&#32;__attribute__((__stdcall__));
249 
250 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_undo)(editor&#32;*)&#32;__attribute__((__stdcall__));
251 
252 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_redo)(editor&#32;*)&#32;__attribute__((__stdcall__));
253 
254 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_but_reverse)(editor&#32;*)&#32;__attribute__((__stdcall__));
255 
256 <emphasis role="keyword">extern</emphasis>&#32;void&#32;(*ted_text_colored_asm)()&#32;__attribute__((__stdcall__));
257 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;editor_text_colored(editor&#32;*ed)
258 {
259 &#32;&#32;&#32;&#32;__asm__&#32;__volatile__(
260 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;call&#32;*%0&#32;\n\t&quot;</emphasis>&#32;::<emphasis role="stringliteral">&quot;m&quot;</emphasis>(ted_text_colored_asm),&#32;<emphasis role="stringliteral">&quot;D&quot;</emphasis>(ed)&#32;:);
261 }
262 
263 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;uint32_t&#32;get_control_keys(<emphasis role="keywordtype">void</emphasis>)
264 {
265 &#32;&#32;&#32;&#32;uint32_t&#32;ctrl;
266 
267 &#32;&#32;&#32;&#32;__asm__&#32;__volatile__(
268 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;int&#32;$0x40&#32;\n\t&quot;</emphasis>
269 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:&#32;<emphasis role="stringliteral">&quot;=a&quot;</emphasis>(ctrl)
270 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:&#32;<emphasis role="stringliteral">&quot;a&quot;</emphasis>(66),&#32;<emphasis role="stringliteral">&quot;b&quot;</emphasis>(3));
271 
272 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;ctrl;
273 };
274 
275 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;get_keyboard_layout(<emphasis role="keywordtype">int</emphasis>&#32;opt,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*buf)
278 {
279 &#32;&#32;&#32;&#32;uint32_t&#32;<link linkend="_namespace_kolibri_lib_1_1_o_s_1ad74e24145535693721b73b3d7f315c45">lang</link>;
280 
281 &#32;&#32;&#32;&#32;__asm__&#32;__volatile__(
282 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;int&#32;$0x40&#32;\n\t&quot;</emphasis>
283 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:&#32;<emphasis role="stringliteral">&quot;=a&quot;</emphasis>(<link linkend="_namespace_kolibri_lib_1_1_o_s_1ad74e24145535693721b73b3d7f315c45">lang</link>)
284 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:&#32;<emphasis role="stringliteral">&quot;a&quot;</emphasis>(26),&#32;<emphasis role="stringliteral">&quot;b&quot;</emphasis>(2),&#32;<emphasis role="stringliteral">&quot;c&quot;</emphasis>(opt),&#32;<emphasis role="stringliteral">&quot;d&quot;</emphasis>(buf));
285 
286 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_namespace_kolibri_lib_1_1_o_s_1ad74e24145535693721b73b3d7f315c45">lang</link>;
287 };
288 
289 __attribute__((__stdcall__))&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;editor_key(editor&#32;*ed,&#32;oskey_t&#32;key)
290 <emphasis role="comment">//&#32;callback&#32;for&#32;gui</emphasis>
291 {
292 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;if(ed-&gt;el_focus&#32;!=&#32;ed)&#32;return;&#32;&#32;//&#32;need&#32;to&#32;check&#32;not&#32;to&#32;lose&#32;keyb&#32;buffer</emphasis>
293 
294 &#32;&#32;&#32;&#32;uint32_t&#32;control&#32;=&#32;get_control_keys();
295 &#32;&#32;&#32;&#32;<emphasis role="keyword">enum</emphasis>&#32;control_keys&#32;ed_ctrl&#32;=&#32;0;
296 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;ly_opt&#32;=&#32;1;
297 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(control&#32;&amp;&#32;3)
298 &#32;&#32;&#32;&#32;{
299 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed_ctrl&#32;|=&#32;KM_SHIFT;
300 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ly_opt&#32;=&#32;2;
301 &#32;&#32;&#32;&#32;}
302 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(control&#32;&amp;&#32;0xC)
303 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed_ctrl&#32;|=&#32;KM_CTRL;
304 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(control&#32;&amp;&#32;0x30)
305 &#32;&#32;&#32;&#32;{
306 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed_ctrl&#32;|=&#32;KM_ALT;
307 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ly_opt&#32;=&#32;3;
308 &#32;&#32;&#32;&#32;}
309 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(control&#32;&amp;&#32;0x80)
310 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed_ctrl&#32;|=&#32;KM_NUMLOCK;
311 
312 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;conv_table[128];
313 &#32;&#32;&#32;&#32;get_keyboard_layout(ly_opt,&#32;conv_table);
314 
315 &#32;&#32;&#32;&#32;editor_keyboard(ed,&#32;conv_table,&#32;ed_ctrl,&#32;key.val);
316 }
317 
318 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;gui_add_editor(<link linkend="_structkolibri__window">kolibri_window</link>&#32;*wnd,&#32;editor&#32;*e)
319 {
320 &#32;&#32;&#32;&#32;kolibri_window_add_element(wnd,&#32;KOLIBRI_EDITOR,&#32;e);
321 }
322 
323 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;editor&#32;*kolibri_new_editor(uint32_t&#32;x_w,&#32;uint32_t&#32;y_h,&#32;uint32_t&#32;font,&#32;uint32_t&#32;max_chars,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*editor_interlock)
325 
326 {
327 &#32;&#32;&#32;&#32;editor&#32;*ed&#32;=&#32;(editor&#32;*)calloc(1,&#32;<emphasis role="keyword">sizeof</emphasis>(editor));
328 &#32;&#32;&#32;&#32;ed-&gt;x_pos&#32;=&#32;x_w&#32;&gt;&gt;&#32;16;
329 &#32;&#32;&#32;&#32;ed-&gt;width&#32;=&#32;x_w&#32;&amp;&#32;0xFFFF;
330 &#32;&#32;&#32;&#32;ed-&gt;y_pos&#32;=&#32;y_h&#32;&gt;&gt;&#32;16;
331 &#32;&#32;&#32;&#32;ed-&gt;hight&#32;=&#32;y_h&#32;&amp;&#32;0xFFFF;
332 
333 &#32;&#32;&#32;&#32;ed-&gt;w_pane&#32;=&#32;30;
334 &#32;&#32;&#32;&#32;ed-&gt;h_pane&#32;=&#32;20;
335 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;font</emphasis>
336 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(font&#32;==&#32;0)
337 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;font&#32;=&#32;0x10;&#32;<emphasis role="comment">//&#32;default&#32;16&#32;=&#32;8x16</emphasis>
338 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;font_multipl&#32;=&#32;(font&#32;&amp;&#32;7)&#32;+&#32;1;
339 &#32;&#32;&#32;&#32;ed-&gt;font_size&#32;=&#32;font&#32;&lt;&lt;&#32;24;
340 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(font&#32;&amp;&#32;0x10)&#32;<emphasis role="comment">//&#32;8x16</emphasis>
341 &#32;&#32;&#32;&#32;{
342 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;width_sym&#32;=&#32;8&#32;*&#32;font_multipl;
343 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;hight_sym&#32;=&#32;16&#32;*&#32;font_multipl;
344 &#32;&#32;&#32;&#32;}
345 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="comment">//&#32;6x9</emphasis>
346 &#32;&#32;&#32;&#32;{
347 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;width_sym&#32;=&#32;6&#32;*&#32;font_multipl;
348 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;hight_sym&#32;=&#32;9&#32;*&#32;font_multipl;
349 &#32;&#32;&#32;&#32;}
350 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;memory&#32;sizing&#32;for&#32;text&#32;&amp;&#32;syntax</emphasis>
351 &#32;&#32;&#32;&#32;ed-&gt;max_chars&#32;=&#32;max_chars;
352 &#32;&#32;&#32;&#32;ed-&gt;increase_size&#32;=&#32;max_chars&#32;/&#32;2;
353 &#32;&#32;&#32;&#32;ed-&gt;syntax_file_size&#32;=&#32;<emphasis role="keyword">sizeof</emphasis>(default_syntax);
354 
355 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;//&#32;loaded&#32;auto&#32;from&#32;syntax</emphasis>
356 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;color_cursor&#32;=&#32;0x808080;</emphasis>
357 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;color_wnd_capt&#32;=&#32;0x80;</emphasis>
358 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;color_wnd_bord&#32;=&#32;0xd0d0d0;</emphasis>
359 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;color_select&#32;=&#32;0x208080;</emphasis>
360 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;color_cur_text&#32;=&#32;0xff0000;</emphasis>
361 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ed-&gt;color_wnd_text&#32;=&#32;0xffff00;</emphasis>
362 <emphasis role="comment">&#32;&#32;&#32;&#32;*/</emphasis>
363 &#32;&#32;&#32;&#32;ed-&gt;symbol_new_line&#32;=&#32;20;&#32;<emphasis role="comment">//&#32;ascii(20)</emphasis>
364 
365 &#32;&#32;&#32;&#32;ed-&gt;scr_w&#32;=&#32;kolibri_new_scrollbar_def(X_Y(0,&#32;16),&#32;X_Y(0,&#32;0),&#32;100,&#32;30,&#32;0);&#32;<emphasis role="comment">//&#32;cur_area&#32;will&#32;be&#32;inited&#32;ltr,&#32;max&#32;&amp;&#32;pos&#32;undef</emphasis>
366 &#32;&#32;&#32;&#32;ed-&gt;scr_h&#32;=&#32;kolibri_new_scrollbar_def(X_Y(0,&#32;0),&#32;X_Y(0,&#32;16),&#32;100,&#32;30,&#32;0);&#32;<emphasis role="comment">//&#32;cur_area&#32;will&#32;be&#32;inited&#32;ltr,&#32;max&#32;&amp;&#32;pos&#32;undef</emphasis>
367 
368 &#32;&#32;&#32;&#32;ed-&gt;buffer_size&#32;=&#32;TE_BUF_SIZE;
369 &#32;&#32;&#32;&#32;ed-&gt;buffer&#32;=&#32;malloc(TE_BUF_SIZE);
370 &#32;&#32;&#32;&#32;ed-&gt;buffer_find&#32;=&#32;malloc(TE_BUF_SIZE&#32;/&#32;8);&#32;<emphasis role="comment">//&#32;where&#32;to&#32;store&#32;text&#32;to&#32;search</emphasis>
371 
372 &#32;&#32;&#32;&#32;ed-&gt;cur_ins&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;insert&#32;mode&#32;default</emphasis>
373 &#32;&#32;&#32;&#32;ed-&gt;mode_color&#32;=&#32;1;&#32;<emphasis role="comment">//&#32;can&#32;select&#32;text</emphasis>
374 &#32;&#32;&#32;&#32;ed-&gt;mode_invis&#32;=&#32;1;&#32;<emphasis role="comment">//&#32;show&#32;nonprinted&#32;symbols</emphasis>
375 
376 &#32;&#32;&#32;&#32;ed-&gt;el_focus&#32;=&#32;editor_interlock;
377 
378 &#32;&#32;&#32;&#32;(*ted_init)(ed);&#32;<emphasis role="comment">//&#32;memory&#32;allocation,&#32;cleaning</emphasis>
379 &#32;&#32;&#32;&#32;ed-&gt;syntax_file&#32;=&#32;(<emphasis role="keywordtype">char</emphasis>&#32;*)&amp;default_syntax;
380 &#32;&#32;&#32;&#32;(*ted_init_syntax_file)(ed);&#32;<emphasis role="comment">//&#32;load&#32;colors&#32;and&#32;syntax&#32;highlight</emphasis>
381 &#32;&#32;&#32;&#32;ed-&gt;help_text_f1&#32;=&#32;f1_table;&#32;<emphasis role="comment">//&#32;override&#32;if&#32;not&#32;aligned&#32;immediately&#32;after&#32;syntax&#32;words</emphasis>
382 &#32;&#32;&#32;&#32;ed-&gt;key_words_data&#32;=&#32;&amp;word1;
383 
384 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;ed;
385 }
386 
388 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;editor_symbol_not_vis(editor&#32;*ed,&#32;<emphasis role="keyword">struct</emphasis>&#32;editor_symbol&#32;*sym)
389 {
390 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(sym-&gt;td&#32;&amp;&amp;&#32;sym-&gt;td&#32;+&#32;ed-&gt;tim_undo&#32;&lt;=&#32;ed-&gt;tim_ch)&#32;||&#32;(sym-&gt;tc&#32;&gt;&#32;ed-&gt;tim_ch&#32;-&#32;ed-&gt;tim_undo);
391 }
392 
394 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;uint32_t&#32;editor_iterat_next(editor&#32;*ed,&#32;uint32_t&#32;idx)
395 {
396 &#32;&#32;&#32;&#32;uint32_t&#32;i;
397 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ed-&gt;tim_undo)
398 &#32;&#32;&#32;&#32;{
399 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;ed-&gt;tex[idx].next;&#32;i&#32;!=&#32;0&#32;&amp;&amp;&#32;(ed-&gt;tex[i].c&#32;==&#32;<emphasis role="charliteral">&apos;\n&apos;</emphasis>&#32;||&#32;editor_symbol_not_vis(ed,&#32;ed-&gt;tex&#32;+&#32;i));&#32;i&#32;=&#32;ed-&gt;tex[i].next)
400 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;;
401 &#32;&#32;&#32;&#32;}
402 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>
403 &#32;&#32;&#32;&#32;{
404 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;ed-&gt;tex[idx].next;&#32;i&#32;!=&#32;0&#32;&amp;&amp;&#32;(ed-&gt;tex[i].c&#32;==&#32;<emphasis role="charliteral">&apos;\n&apos;</emphasis>&#32;||&#32;ed-&gt;tex[i].td);&#32;i&#32;=&#32;ed-&gt;tex[i].next)
405 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;;
406 &#32;&#32;&#32;&#32;}
407 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;i;
408 }
409 
410 <emphasis role="comment">//&#32;returns&#32;malloc&apos;ed&#32;mem</emphasis>
411 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">inline</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*editor_get_text(editor&#32;*ed)
412 {
413 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;*buf&#32;=&#32;malloc(ed-&gt;max_chars),&#32;*pc&#32;=&#32;buf;
414 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!pc)
415 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;
416 
417 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;i;
418 &#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;&#32;&#32;&#32;*pc++&#32;=&#32;ed-&gt;tex[0].c;</emphasis>
419 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;ed-&gt;tex[0].next;&#32;i;&#32;i&#32;=&#32;editor_iterat_next(ed,&#32;i))
420 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*pc++&#32;=&#32;ed-&gt;tex[i].c;
421 &#32;&#32;&#32;&#32;*pc++&#32;=&#32;<emphasis role="charliteral">&apos;\0&apos;</emphasis>;
422 
423 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;buf;
424 }
425 
426 <emphasis role="comment">/*</emphasis>
427 <emphasis role="comment">char*&#32;&#32;editor_get_text20(editor*&#32;ed)</emphasis>
428 <emphasis role="comment">{</emphasis>
429 <emphasis role="comment">&#32;&#32;&#32;&#32;char&#32;&#32;&#32;&#32;*buf&#32;=&#32;malloc(ed-&gt;max_chars),&#32;*pc&#32;=&#32;buf;</emphasis>
430 <emphasis role="comment">&#32;&#32;&#32;&#32;if&#32;(!pc)&#32;return&#32;NULL;</emphasis>
431 <emphasis role="comment"></emphasis>
432 <emphasis role="comment">&#32;&#32;&#32;&#32;int&#32;&#32;i&#32;=&#32;ed-&gt;tex[0].next,&#32;c&#32;=&#32;0;</emphasis>
433 <emphasis role="comment">&#32;&#32;&#32;&#32;for&#32;(;&#32;i&#32;&gt;&#32;0&#32;&amp;&amp;&#32;c&#32;&lt;&#32;30;&#32;c++,&#32;i&#32;=&#32;ed-&gt;tex[i].next)&#32;*pc++&#32;=&#32;ed-&gt;tex[i].c;</emphasis>
434 <emphasis role="comment">&#32;&#32;&#32;&#32;*pc++&#32;=&#32;&apos;\0&apos;;</emphasis>
435 <emphasis role="comment"></emphasis>
436 <emphasis role="comment">&#32;&#32;&#32;&#32;return&#32;buf;</emphasis>
437 <emphasis role="comment">}</emphasis>
438 <emphasis role="comment">*/</emphasis>
439 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">//&#32;KOLIBRI_EDITOR_H</emphasis>
</programlisting></section>
